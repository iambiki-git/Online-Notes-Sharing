{% extends "notes/base.html" %}
{% load static %}
{% block heroSection %}{% endblock %}
{% block dashboard %}{% endblock %}
{% block notes %}
<div class="bg-zinc-900 text-white min-h-screen p-6 md:p-12">
    
    <!-- Search Bar Section -->
    <div class="mb-8 flex justify-center">
        <div class="w-full md:w-1/2">
            <input type="text" id="searchInput" placeholder="Search notes..." 
                   class="w-full px-4 py-2 text-slate-300 bg-zinc-800 rounded-lg focus:outline-none focus:ring focus:ring-blue-500" 
                   oninput="searchNotes()">
        </div>
    </div>

    <!-- Notes Section -->
    <div id="notesContainer" class="grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
        {% for note in notes %}
        <div class="bg-zinc-800 hover:bg-zinc-900 p-6 rounded-lg shadow-lg hover:shadow-2xl transition-shadow duration-200 ease-in-out">
            <h2 class="text-lg font-semibold text-slate-300 mb-2">{{ note.faculty }}</h2>
            <p class="text-slate-400 text-sm mb-4">Subject: {{ note.subject }}</p>
            <p class="text-slate-400 text-sm mb-4">Title: {{ note.title|truncatewords:20 }}</p>
            <div class="flex justify-between items-center">
                {% if user.is_authenticated %}
                <!-- Preview Link -->
                <a href="{% url 'note_preview' note.id %}" 
                   class="text-blue-400 hover:underline"
                   target="_blank">
                    Preview
                </a>
                {% endif %}
                
                <!-- Download Icon  -->
                {% if user.is_authenticated %}
                    <a href="{% url 'download_note' note.id %}" download
                    class="text-blue-400 hover:text-blue-500 ml-2">
                        <i class='bx bxs-download text-xl'></i>
                    </a>
                {% else %}
                    <a href="{% url 'login' %}"
                    class="text-blue-400 hover:text-blue-500 ml-2">
                        <i class='bx bxs-download text-xl'></i>
                    </a>
                {% endif %}
                
                <!-- Upload Date -->
                <p class="text-sm text-slate-500">{{ note.upload_date|date:"M d, Y" }}</p>
            </div>
        </div>
        {% empty %}
        <p class="text-slate-400 col-span-full text-center mt-6">No notes found.</p>
        {% endfor %}
    </div>
     {% comment %} <!-- No Results Found Message -->
     <p id="noResultsMessage" class="text-slate-400 col-span-full text-center mt-6" style="display:none;">No results found.</p> {% endcomment %}

     <!-- Pagination Controls -->
    <div class="flex justify-center mt-8">
        <div class="flex items-center space-x-2">
            {% if notes.has_previous %}
                <a href="?page=1" class="px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded hover:bg-blue-700 transition duration-300 ease-in-out">&laquo; First</a>
                <a href="?page={{ notes.previous_page_number }}" class="px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded hover:bg-blue-700 transition duration-300 ease-in-out">Previous</a>
            {% endif %}

            <span class="text-sm font-medium text-gray-500">
                Page {{ notes.number }} of {{ notes.paginator.num_pages }}.
            </span>

            {% if notes.has_next %}
                <a href="?page={{ notes.next_page_number }}" class="px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded hover:bg-blue-700 transition duration-300 ease-in-out">Next</a>
                <a href="?page={{ notes.paginator.num_pages }}" class="px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded hover:bg-blue-700 transition duration-300 ease-in-out">Last &raquo;</a>
            {% endif %}
        </div>
    </div>


</div>

<script>
    // Search Notes Functionality
    function searchNotes() {
        const searchQuery = document.getElementById('searchInput').value.toLowerCase();
        const notes = document.querySelectorAll('#notesContainer > div');
       // let hasResults = false;
        
        notes.forEach(note => {
            const subject = note.querySelector('p').textContent.toLowerCase();
            const title = note.querySelector('p').textContent.toLowerCase();

            if (subject.includes(searchQuery) || title.includes(searchQuery)) {
                note.style.display = "block";
                //let hasResults = true;

            } else {
                note.style.display = "none";
            }
        });
        // Show "No results found" message if no notes match the search query
       // document.getElementById('noResultsMessage').style.display = hasResults ? "none" : "block";
    }
</script>
{% endblock %}
